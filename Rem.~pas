unit Rem;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids, DBGrids, StdCtrls, Mask, ToolEdit, DBCtrls, GridsEh,
  DBGridEh;

type
  TfRem = class(TForm)
    cebFIO: TCheckBox;
    cebName: TCheckBox;
    eFIO: TEdit;
    eName: TEdit;
    DBGridEh1: TDBGridEh;
    cebStatus: TCheckBox;
    cobStatus: TComboBox;
    lKol: TLabel;
    procedure FormShow(Sender: TObject);
    procedure NewFiltr;
    procedure FiltrBase;
    procedure Filtr(var str:string);
    procedure eFIOChange(Sender: TObject);
    procedure cebFIOClick(Sender: TObject);
    procedure cebNameClick(Sender: TObject);
    procedure eNameChange(Sender: TObject);
    procedure DBGridEh1KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure cebStatusClick(Sender: TObject);
    procedure cobStatusChange(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  fRem: TfRem;

implementation

uses RemDM;

{$R *.dfm}

procedure TfRem.FormShow(Sender: TObject);
begin
  NewFiltr;
  dmRem.adotRem.Filtered:=false;
  lKol.Caption:=IntToStr(dmRem.adotRem.RecordCount);
end;

procedure TfRem.NewFiltr;
begin
  cebFIO.Checked:=false;
  eFIO.Text:='';
  cebName.Checked:=false;
  eName.Text:='';
end;

procedure TfRem.FiltrBase;
var strFiltr:string;
begin
  Filtr(strFiltr);
  dmRem.adotRem.Filter:=strFiltr;
  dmRem.adotRem.Filtered:=(strFiltr<>'');
  lKol.Caption:=IntToStr(dmRem.adotRem.RecordCount);
end;

procedure TfRem.Filtr(var str:string);
var s:string;
begin
  if cebFIO.Checked then
    if s='' then
      s:=s+'ФИО LIKE ''*'+eFIO.Text+'*'''
    else
      s:=s+' AND ФИО LIKE ''*'+eFIO.Text+'*''';
  if cebName.Checked then
    if s='' then
      s:=s+'Наименование LIKE ''*'+eName.Text+'*'''
    else
      s:=s+' AND Наименование LIKE ''*'+eName.Text+'*''';
  if cebStatus.Checked then
    if s='' then
      s:=s+'Статус LIKE ''*'+cobStatus.Text+'*'''
    else
      s:=s+' AND Статус LIKE ''*'+cobStatus.Text+'*''';
  str:=s;
end;


procedure TfRem.eFIOChange(Sender: TObject);
begin
  if eFIO.Text<>'' then
    begin
      cebFIO.Checked:=true;
      FiltrBase;
    end;
end;

procedure TfRem.cebFIOClick(Sender: TObject);
begin
  if cebFIO.Checked=false then
    eFIO.Text:='';
  FiltrBase;
end;

procedure TfRem.cebNameClick(Sender: TObject);
begin
  if cebName.Checked=false then
    eName.Text:='';
  FiltrBase;
end;

procedure TfRem.eNameChange(Sender: TObject);
begin
  if eName.Text<>'' then
    begin
      cebName.Checked:=true;
      FiltrBase;
    end;
end;

procedure TfRem.DBGridEh1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if key=46 then
    if MessageDlg('Вы уверены что хотите удалить?',mtWarning,mbOkCancel,0)=mrOk then
      dmRem.adotRem.Delete;
  lKol.Caption:=IntToStr(dmRem.adotRem.RecordCount);
end;

procedure TfRem.cebStatusClick(Sender: TObject);
begin
  if cebStatus.Checked=false then
    cobStatus.Text:='';
  FiltrBase;
end;

procedure TfRem.cobStatusChange(Sender: TObject);
begin
  if cobStatus.Text<>'' then
    begin
      cebStatus.Checked:=true;
      FiltrBase;
    end;
end;

end.
